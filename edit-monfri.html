<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Monday-Friday - Allied School</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="navbar">
                <div class="logo">
                    <i class="fas fa-school"></i>
                    <span>Allied School</span>
                </div>
                <div class="nav-links">
                    <a href="index.html"><i class="fas fa-home"></i> Home</a>
                    <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="timetable-container">
            <div class="timetable-header">
                <h1 class="timetable-title">Edit Monday-Friday Timetable</h1>
                <div>
                    <button class="btn" id="add-entry-btn"><i class="fas fa-plus"></i> Add Entry</button>
                    <a href="dashboard.html" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
                </div>
            </div>
            
            <table class="timetable">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Class</th>
                        <th>Subject</th>
                        <th>Teacher</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="timetable-body">
                    <!-- Timetable data will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <!-- Add/Edit Form (Initially Hidden) -->
        <div id="entry-form" class="timetable-container" style="display: none; margin-top: 30px;">
            <h2 id="form-title">Add New Entry</h2>
            <form id="class-form">
                <input type="hidden" id="entry-id">
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="class-name">Class Name</label>
                        <input type="text" id="class-name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <input type="text" id="subject" class="form-control" required>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="start-time">Start Time</label>
                        <input type="time" id="start-time" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="end-time">End Time</label>
                        <input type="time" id="end-time" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="teacher">Teacher (Optional)</label>
                    <input type="text" id="teacher" class="form-control">
                </div>
                
                <div class="action-buttons">
                    <button type="submit" class="btn">Save Entry</button>
                    <button type="button" class="btn btn-outline" id="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2023 Allied School Timetable System. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let editingId = null;
        
        // Load Monday-Friday timetable data for editing
        document.addEventListener('DOMContentLoaded', function() {
            loadTimetableData();
            
            // Add entry button
            document.getElementById('add-entry-btn').addEventListener('click', function() {
                showEntryForm();
            });
            
            // Cancel button
            document.getElementById('cancel-btn').addEventListener('click', function() {
                hideEntryForm();
            });
            
            // Form submission
            document.getElementById('class-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEntry();
            });
        });
        
        function loadTimetableData() {
            const monfriData = JSON.parse(localStorage.getItem('monfriData')) || [];
            const timetableBody = document.getElementById('timetable-body');
            
            if (monfriData.length === 0) {
                timetableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No timetable data available</td></tr>';
                return;
            }
            
            let html = '';
            monfriData.forEach(item => {
                html += `
                    <tr>
                        <td class="time-cell">${item.startTime} - ${item.endTime}</td>
                        <td>${item.class}</td>
                        <td class="subject-cell">${item.subject}</td>
                        <td class="teacher-cell">${item.teacher || '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editEntry(${item.id})"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" onclick="deleteEntry(${item.id})"><i class="fas fa-trash"></i></button>
                                <button class="action-btn move-btn" onclick="moveUp(${item.id})"><i class="fas fa-arrow-up"></i></button>
                                <button class="action-btn move-btn" onclick="moveDown(${item.id})"><i class="fas fa-arrow-down"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            timetableBody.innerHTML = html;
        }
        
        function showEntryForm(entry = null) {
            const form = document.getElementById('entry-form');
            const title = document.getElementById('form-title');
            
            if (entry) {
                title.textContent = 'Edit Entry';
                document.getElementById('entry-id').value = entry.id;
                document.getElementById('class-name').value = entry.class;
                document.getElementById('subject').value = entry.subject;
                document.getElementById('start-time').value = entry.startTime;
                document.getElementById('end-time').value = entry.endTime;
                document.getElementById('teacher').value = entry.teacher || '';
            } else {
                title.textContent = 'Add New Entry';
                document.getElementById('class-form').reset();
                document.getElementById('entry-id').value = '';
            }
            
            form.style.display = 'block';
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function hideEntryForm() {
            document.getElementById('entry-form').style.display = 'none';
            editingId = null;
        }
        
        function saveEntry() {
            const id = document.getElementById('entry-id').value;
            const className = document.getElementById('class-name').value;
            const subject = document.getElementById('subject').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const teacher = document.getElementById('teacher').value;
            
            let monfriData = JSON.parse(localStorage.getItem('monfriData')) || [];
            
            if (id) {
                // Update existing entry
                const index = monfriData.findIndex(item => item.id == id);
                if (index !== -1) {
                    monfriData[index] = {
                        id: parseInt(id),
                        class: className,
                        subject: subject,
                        teacher: teacher,
                        startTime: startTime,
                        endTime: endTime
                    };
                }
            } else {
                // Add new entry
                const newId = monfriData.length > 0 ? Math.max(...monfriData.map(item => item.id)) + 1 : 1;
                monfriData.push({
                    id: newId,
                    class: className,
                    subject: subject,
                    teacher: teacher,
                    startTime: startTime,
                    endTime: endTime
                });
            }
            
            localStorage.setItem('monfriData', JSON.stringify(monfriData));
            loadTimetableData();
            hideEntryForm();
            
            alert('Entry saved successfully!');
        }
        
        function editEntry(id) {
            const monfriData = JSON.parse(localStorage.getItem('monfriData')) || [];
            const entry = monfriData.find(item => item.id === id);
            
            if (entry) {
                showEntryForm(entry);
            }
        }
        
        function deleteEntry(id) {
            if (confirm('Are you sure you want to delete this entry?')) {
                let monfriData = JSON.parse(localStorage.getItem('monfriData')) || [];
                monfriData = monfriData.filter(item => item.id !== id);
                localStorage.setItem('monfriData', JSON.stringify(monfriData));
                loadTimetableData();
                alert('Entry deleted successfully!');
            }
        }
        
        function moveUp(id) {
            let monfriData = JSON.parse(localStorage.getItem('monfriData')) || [];
            const index = monfriData.findIndex(item => item.id === id);
            
            if (index > 0) {
                // Swap with previous item
                [monfriData[index], monfriData[index - 1]] = [monfriData[index - 1], monfriData[index]];
                localStorage.setItem('monfriData', JSON.stringify(monfriData));
                loadTimetableData();
            }
        }
        
        function moveDown(id) {
            let monfriData = JSON.parse(localStorage.getItem('monfriData')) || [];
            const index = monfriData.findIndex(item => item.id === id);
            
            if (index < monfriData.length - 1) {
                // Swap with next item
                [monfriData[index], monfriData[index + 1]] = [monfriData[index + 1], monfriData[index]];
                localStorage.setItem('monfriData', JSON.stringify(monfriData));
                loadTimetableData();
            }
        }
    </script>
</body>
</html>
